(()=>{var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};(()=>{"use strict";var t={};e.r(t),e.d(t,{initAlternativeEdition:()=>A,initControlEdition:()=>C});var n={};e.r(n),e.d(n,{initAlternativeEdition:()=>q,initControlEdition:()=>B});const i=window.wp.element;function r(e,t){t&&(i.createRoot?(0,i.createRoot)(t).render(e):(0,i.render)(e,t))}const o=window.wp.data;function a(e,t){return(0,o.subscribe)(e,t)}var l=window.wp.blockEditor.store;const c=window.nab.utils,u=window.lodash;var d=function(e,t,n){if(n||2===arguments.length)for(var i,r=0,o=t.length;r<o;r++)!i&&r in t||(i||(i=Array.prototype.slice.call(t,0,r)),i[r]=t[r]);return e.concat(i||Array.prototype.slice.call(t))};function s(e){var t=document.getElementById("nab-widget-global-style");if(t){var n=e.reduce((function(e,t){return"".concat(e,"\n#block-").concat(t," { display: none; }")}),"");t.textContent=n}}function f(e){var t=e.attributes.id;return"string"==typeof t&&t.startsWith("nab_alt_sidebar")}const p=window.wp.apiFetch;var m=e.n(p);const b=window.wp.date,g=window.wp.url;var w=function(){return w=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},w.apply(this,arguments)};const v=function(e){var t=e.url,n=e.path,i=(0,b.format)("YmjHi").substring(0,11)+"0";return m()(w(w(w({},e),t&&{url:y(e)?(0,g.addQueryArgs)(t,{nabts:i}):t}),n&&{path:(0,g.addQueryArgs)(n,{nabts:i})}))};var y=function(e){var t,n;return!!(null===(t=e.url)||void 0===t?void 0:t.includes("/wp-json/"))||!!(null===(n=e.url)||void 0===n?void 0:n.includes("rest_route"))||!!Object.keys(e).includes("rest_route")};const h=window.wp.components,E=window.wp.i18n,_=window.nab.components;var x=function(e){var t=e.experiment,n=e.alternative,r=(0,i.useState)(!1),o=r[0],a=r[1],l=(0,i.useState)(!1),c=l[0],u=l[1],d=o?(0,E._x)("Duplicating…","text (widgets)","nelio-ab-testing"):(0,E._x)("Duplicate","command","nelio-ab-testing");return i.createElement(i.Fragment,null,i.createElement(h.Button,{variant:"secondary",onClick:function(){return u(!0)}},(0,E._x)("Duplicate Control Widgets","command","nelio-ab-testing")),i.createElement(_.ConfirmationDialog,{title:(0,E._x)("Duplicate Control Widgets?","title","nelio-ab-testing"),text:(0,E._x)("This will overwrite any widgets you may have in this variant with those included in your theme. Are you sure you want to continue?","user","nelio-ab-testing"),confirmLabel:d,isConfirmEnabled:!o,isCancelEnabled:!o,isDismissible:!o,isOpen:c,onCancel:function(){return u(!1)},onConfirm:function(){o||(a(!0),v({path:(0,g.addQueryArgs)("/nab/v1/widget/duplicate-control",{experiment:t,alternative:n}),method:"PUT"}).finally((function(){return window.location.reload()})))}}))};function C(){var e,t;e=[],a(t=(0,u.debounce)((function(){var t=(0,o.select)(l).getBlocks().filter((function(e){return"core/widget-area"===e.name})),n=t.map((function(e){return e.clientId}));(0,c.areEqual)(e,n)||(e=n,s(t.filter(f).map((function(e){return e.clientId}))))}),100),l),t()}function A(e){!function(e){e=d(d([],e,!0),["wp_inactive_widgets"],!1);var t=[],n=(0,u.debounce)((function(){var n=(0,o.select)(l).getBlocks().filter((function(e){return"core/widget-area"===e.name})),i=n.map((function(e){return e.clientId}));(0,c.areEqual)(t,i)||(t=i,s(n.filter((function(t){var n=t.attributes.id;return"string"==typeof n&&!e.includes(n)})).map((function(e){return e.clientId}))))}),100);a(n,l),n()}(e.sidebars),function(e){var t=0,n=function(){var o,a=document.querySelector(".edit-widgets-header__actions");!(null===(o=null==a?void 0:a.children)||void 0===o?void 0:o.length)&&t<40?setTimeout(n,250*++t):a&&function(t){var n=t.children[0];if(n){var o=document.createElement("div");t.insertBefore(o,n),r(i.createElement(x,{experiment:e.experiment,alternative:e.alternative}),o)}}(a)};n()}(e)}const S=window.nab.data;function O(){return Array.from(document.querySelectorAll("div[id^=nab_alt_sidebar_]"))}function D(){O().forEach((function(e){return function(e){var t=function(e){var t=e.replace(/^nab_alt_sidebar_[0-9]+_([^-]+-){4}[^-]+_/,"");return t===e?"":t}(e.getAttribute("id")||"");if(t){var n=document.getElementById(t);n&&e.parentElement&&n.parentElement&&(0,c.appendSibling)(e.parentElement,n.parentElement)}}(e)}))}var j=function(e){var t=e.experiment,n=e.alternative,r=k(),o=r[0],a=r[1],l=P(t,n),c=l[0],u=l[1];return i.createElement("span",null,i.createElement(h.Button,{className:"page-title-action",onClick:function(){return a(!0)},style:{height:"auto"}},(0,E._x)("Duplicate Control Widgets","command","nelio-ab-testing")),i.createElement(_.ConfirmationDialog,{title:(0,E._x)("Duplicate Control Widgets?","title","nelio-ab-testing"),text:(0,E._x)("This will overwrite any widgets you may have in this variant with those included in your theme. Are you sure you want to continue?","user","nelio-ab-testing"),confirmLabel:c?(0,E._x)("Duplicating…","text (widgets)","nelio-ab-testing"):(0,E._x)("Duplicate","command","nelio-ab-testing"),isConfirmEnabled:!c,isCancelEnabled:!c,isOpen:o,onCancel:function(){return a(!1)},onConfirm:u}))},k=function(){return(0,S.usePageAttribute)("widgets/isConfirmationDialogForWidgetDuplicationVisible",!1)},P=function(e,t){var n=(0,S.usePageAttribute)("widgets/isDuplicatingWidgets",!1),r=n[0],o=n[1];return(0,i.useEffect)((function(){r&&v({path:(0,g.addQueryArgs)("/nab/v1/widget/duplicate-control",{experiment:e,alternative:t}),method:"PUT"}).finally((function(){window.location.reload()}))}),[r]),[r,function(){return o(!0)}]};function B(){D(),O().forEach((function(e){e.parentElement&&(e.parentElement.style.display="none")}))}function q(e){var t;D(),Array.from(document.querySelectorAll(".sidebars-column-1 > .widgets-holder-wrap, .sidebars-column-2 > .widgets-holder-wrap")).forEach((function(e){return e.style.display="none"})),(0,u.filter)(e.sidebars.map((function(e){return document.getElementById(e)})),(function(e){return!!e})).forEach((function(e){e.parentElement&&(e.parentElement.style.display="block")})),(t=document.querySelector("#wpbody-content .wrap .wp-heading-inline"))&&(t.textContent=(0,E._x)("Widget Variant","text","nelio-ab-testing")),Array.from(document.querySelectorAll(".page-title-action")).forEach((function(e){return e.remove()})),function(e){var t=document.querySelector("#wpbody-content .wrap .wp-heading-inline"),n=document.createElement("div");r(i.createElement(j,{experiment:e.experiment,alternative:e.alternative}),n);var o=n.children[0],a=document.createElement("a");a.className="page-title-action",a.textContent=(0,E._x)("Back to Test","command","nelio-ab-testing"),a.setAttribute("href",e.links.experimentUrl),t&&((0,c.appendSibling)(a,t),o&&(0,c.appendSibling)(o,t))}(e)}var T,W=function(){return W=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},W.apply(this,arguments)};window.nab=W(W({},(T=window)&&"object"==typeof T&&"nab"in T?window.nab:{}),{widgets:{blocks:t,classic:n}})})();var n=nab="undefined"==typeof nab?{}:nab;for(var i in t)n[i]=t[i];t.__esModule&&Object.defineProperty(n,"__esModule",{value:!0})})();